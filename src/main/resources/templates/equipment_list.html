<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8" />
    <title>設備一覧</title>
    <style>
        table {
            border-collapse: collapse;
            width: 100%;
        }

        th,
        td {
            border: 1px solid #999;
            padding: 8px;
            text-align: left;
        }

        th {
            background-color: #eee;
        }

        .action-buttons form {
            display: inline-block;
            margin: 0 4px;
        }

        .circle {
            font-weight: bold;
            color: green;
            text-align: center;
        }

        /* 上部ボタン用 */
        .top-buttons {
            text-align: right;
            margin: 10px 0;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        /* ボタンの共通スタイル */
        .action-button {
            padding: 10px 20px;
            font-size: 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            transition: background-color 0.2s;
        }

        /* 新規登録ボタン */
        .register-button {
            background-color: #4CAF50;
            color: white;
        }

        .register-button:hover {
            background-color: #45a049;
        }

        /* 削除モードボタン */
        .delete-mode-button {
            background-color: #f44336;
            color: white;
        }

        .delete-mode-button:hover {
            background-color: #da190b;
        }

        /* 減価償却完了の行のスタイル */
        .depreciation-completed {
            background-color: #e3f2fd !important;
        }

        /* 廃棄済み設備の行のスタイル */
        .disposed-equipment {
            background-color: #f5f5f5 !important;
            color: #888 !important;
            opacity: 0.7;
        }

        .disposed-equipment td {
            background-color: #f5f5f5 !important;
            color: #888 !important;
        }

        /* 破損設備の行のスタイル */
        .broken-equipment {
            background-color: #f5f5f5 !important;
            color: #888 !important;
            opacity: 0.7;
        }

        .broken-equipment td {
            background-color: #f5f5f5 !important;
            color: #888 !important;
        }

        /* 減価償却完了セルの特別スタイル */
        .depreciation-completed-cell {
            background-color: #2196f3 !important;
            color: white !important;
            font-weight: bold;
            text-align: center;
        }

        /* グレーアウト時でも〇マークは見やすく */
        .disposed-equipment .circle,
        .broken-equipment .circle {
            color: #666 !important;
            font-weight: bold;
        }
    </style>

</head>

<body>
    <h1>設備一覧</h1>

    <div class="top-buttons">
        <a th:href="@{/equipment/create-form}">
            <button type="button" class="action-button register-button">＋ 新規登録</button>
        </a>
        <a th:href="@{/equipment/delete-mode}">
            <button type="button" class="action-button delete-mode-button">一括削除</button>
        </a>
    </div>

    <table>
        <thead>
            <tr>
                <th>管理番号</th>
                <th>品名</th>
                <th>型番</th>
                <th>メーカー</th>
                <th>仕様</th>
                <th>購入日</th>
                <th>耐用年数 (年)</th>
                <th>減価償却</th>
                <th>使用不能</th>
                <th>貸出可能</th>
                <th>設置場所</th>
                <th>使用期限</th>
                <th>操作</th>
            </tr>
        </thead>
        <tbody>
            <tr th:each="equipment : ${equipments}"
                th:class="${equipment.isDisposed ? 'disposed-equipment' : 
                           equipment.isBroken ? 'broken-equipment' : 
                           (equipment.elapsedYears != null and equipment.lifespanYears != null and equipment.elapsedYears >= equipment.lifespanYears) ? 'depreciation-completed' : ''}">
                
                <td th:text="${equipment.managementNumber}"></td>
                <td th:text="${equipment.name}"></td>
                <td th:text="${equipment.modelNumber}"></td>
                <td th:text="${equipment.manufacturer}"></td>
                <td th:text="${equipment.specification}"></td>
                <td th:text="${equipment.purchaseDate}"></td>
                <td th:text="${equipment.lifespanYears}"></td>
                
                <td th:class="${equipment.elapsedYears != null and equipment.lifespanYears != null and equipment.elapsedYears >= equipment.lifespanYears ? 'depreciation-completed-cell' : ''}">
                    <span th:if="${equipment.elapsedYears != null and equipment.lifespanYears != null}">
                        <span th:text="${equipment.elapsedYears >= equipment.lifespanYears ? '完了' : 
                                       equipment.annualDepreciation != null ? #numbers.formatDecimal(equipment.annualDepreciation, 1, 'COMMA', 2, 'POINT') : '-'}"></span>
                    </span>
                    <span th:if="${equipment.elapsedYears == null or equipment.lifespanYears == null}">-</span>
                </td>
                
                <td class="circle" th:text="${equipment.isBroken} ? '〇' : ''"></td>
                <td class="circle" th:text="${equipment.isAvailableForLoan} ? '〇' : ''"></td>
                <td>
                    <span th:switch="${equipment.locationCode}">
                        <span th:case="'TOKYO'">東京本店</span>
                        <span th:case="'SENDAI'">仙台支店</span>
                        <span th:case="'NIIGATA'">新潟支店</span>
                        <span th:case="'YOKOHAMA'">横浜支店</span>
                        <span th:case="'OSAKA'">大阪支店</span>
                        <span th:case="'SAITAMA'">埼玉支店</span>
                        <span th:case="*">不明</span>
                    </span>
                </td>
                <td th:text="${equipment.usageDeadline != null} ? '〜' + ${#dates.format(equipment.usageDeadline, 'yyyy/MM/dd')} : ''"></td>
                <td class="action-buttons">
                    <form th:action="@{/equipment/edit}" method="get" style="display: inline;">
                        <input type="hidden" name="id" th:value="${equipment.id}" />
                        <button type="submit">編集</button>
                    </form>
                </td>
            </tr>
        </tbody>
    </table>
</body>

</html>